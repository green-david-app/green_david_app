<!doctype html>
<html lang="cs">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>GreenDavid ‚Äì Intern√≠ syst√©m</title>
    <link rel="stylesheet" href="/style.css"/>
  </head>
  <body>
    <header class="header">
      <div class="brand">
        <div class="brand-logo">GD</div>
        <div>
          <div style="font-weight:700">GreenDavid ‚Äì Intern√≠ syst√©m</div>
          <div class="brand-sub">Zak√°zky ‚Ä¢ Zamƒõstnanci ‚Ä¢ Sklad ‚Ä¢ Fotky</div>
        </div>
        <div style="margin-left:auto" class="search">
          <input id="globalsearch" type="search" placeholder="Hledat‚Ä¶"/>
          <button onclick="document.getElementById('globalsearch').focus()">Hledat</button>
        </div>
      </div>
    </header>

    <main class="container">
      <div id="app"></div>
      <p class="small">¬© <span id="year"></span> GreenDavid. Tmav√© UI, vysok√Ω kontrast, bez zelen√©ho p√≠sma.</p>
    </main>

    <!-- React & Babel (no build) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
      const { useState, useMemo } = React;

      // Fakta / seed data
      const EMPLOYEES = [
        { id: "e1", name: "Jan Nov√°k", role: "Zahradn√≠k" },
        { id: "e2", name: "Pavla Svobodov√°", role: "Vedouc√≠ t√Ωmu" },
        { id: "e3", name: "Filip Hor√°k", role: "Technik z√°vlah" },
      ];
      const JOBS = [
        { id: "z1", title: "√ödr≈æba parku ‚Äì Kunice", client: "Obec Kunice", status: "Prob√≠h√°", city: "Kunice", code: "2025-091", date: "2025-10-03" },
        { id: "z2", title: "V√Ωsadba sadu ‚Äì Lipn√≠k", client: "Soukrom√Ω investor", status: "Pl√°n", city: "Lipn√≠k", code: "2025-087", date: "2025-10-06" },
        { id: "z3", title: "Instalace z√°vlah ‚Äì Praha 6", client: "SVJ Bƒõlohorsk√°", status: "Dokonƒçeno", city: "Praha", code: "2025-072", date: "2025-09-25" },
      ];
      const WAREHOUSE = {
        site: "lipnik",
        lipnik: {
          "Rostliny / Trvalky": [
            { id:"p1", name:"Nepeta 'Walker's Low'", qty:120, unit:"ks" },
            { id:"p2", name:"Heuchera mix", qty:80, unit:"ks" },
          ],
          "Rostliny / Tr√°vy": [
            { id:"p3", name:"Calamagrostis 'Karl Foerster'", qty:60, unit:"ks" },
          ],
          "Rostliny / Ke≈ôe": [
            { id:"p4", name:"Buxus sempervirens", qty:45, unit:"ks" },
          ],
          "Rostliny / Stromy": [
            { id:"p5", name:"Pyrus 'Lucasova' 10-12", qty:12, unit:"ks" },
          ],
          "Rostliny / Cibuloviny": [
            { id:"p6", name:"Tulipa 'Queen of Night'", qty:500, unit:"ks" },
          ],
          "Hnojiva/Post≈ôiky": [
            { id:"h1", name:"Kristalon Gold 25 kg", qty:6, unit:"ks" },
            { id:"h2", name:"Roundup Klasik 5 l", qty:2, unit:"ks" },
          ],
          "Materi√°l zahrada": [
            { id:"mz1", name:"Textilie 90g 1,6√ó100 m", qty:5, unit:"role" },
          ],
          "Materi√°l stavba": [
            { id:"ms1", name:"≈†tƒõrk fr. 4-8", qty:18, unit:"t" },
          ],
          "N√°≈ôad√≠": [
            { id:"n1", name:"Motorov√° pila Stihl MS 261", qty:2, unit:"ks" },
          ]
        },
        praha: {
          "Rostliny / Trvalky": [
            { id:"pp1", name:"Salvia nemorosa 'Caradonna'", qty:90, unit:"ks" },
          ]
        }
      };

      function Tabs({value, onChange}){
        const items = [
          {key:"jobs", label:"Zak√°zky"},
          {key:"employees", label:"Zamƒõstnanci"},
          {key:"warehouse", label:"Sklad"},
          {key:"settings", label:"Nastaven√≠"},
        ];
        return (
          <div className="tabs">
            {items.map(it=> (
              <div key={it.key}
                   className={"tab"+(it.key===value?" active":"")}
                   onClick={()=> onChange(it.key)}>{it.label}</div>
            ))}
          </div>
        );
      }

      function Jobs(){
        const [open, setOpen] = useState(null);
        const [stage, setStage] = useState({}); // per job: Pl√°n -> Prob√≠h√° -> Dokonƒçeno

        const pipeline = (s)=>{
          const order = ["Pl√°n","Prob√≠h√°","Dokonƒçeno"];
          const i = order.indexOf(s||"Pl√°n");
          const next = order[(i+1)%order.length];
          return next;
        };

        return (
          <div className="grid" style={{gridTemplateColumns:"1fr 1fr"}}>
            {JOBS.map(z=> (
              <div className="card" key={z.id}>
                <div className="card-h">
                  <div>
                    <div style={{fontWeight:600}}>{z.title}</div>
                    <div className="small">{z.client} ‚Ä¢ {z.city} ‚Ä¢ {z.code}</div>
                  </div>
                  <span className="badge">{stage[z.id]||z.status}</span>
                </div>
                <div className="card-c">
                  <div className="kv small"><span>üìÖ</span> <span>{z.date}</span></div>
                  <hr/>
                  <button className="ghost" onClick={()=> setOpen(open===z.id? null : z.id)}>
                    {open===z.id? "Skr√Ωt detail" : "Zobrazit detail"}
                  </button>
                  {open===z.id && (
                    <div style={{marginTop:12}}>
                      <div className="card" style={{marginBottom:12}}>
                        <div className="card-h"><div>Materi√°l</div><button>P≈ôidat polo≈æku</button></div>
                        <div className="card-c small">
                          <div className="row h"><div className="c" style={{gridColumn:"span 6"}}>N√°zev</div><div className="c" style={{gridColumn:"span 3",textAlign:"right"}}>Mno≈æstv√≠</div><div className="c" style={{gridColumn:"span 2"}}>Jedn.</div><div className="c" style={{gridColumn:"span 1",textAlign:"right"}}>Akce</div></div>
                          <div className="row"><div style={{gridColumn:"span 6"}}>Mulƒçovac√≠ k≈Øra 70 l</div><div style={{gridColumn:"span 3",textAlign:"right"}}>30</div><div style={{gridColumn:"span 2"}}>ks</div><div style={{gridColumn:"span 1",textAlign:"right"}}>‚Äî</div></div>
                          <div className="row"><div style={{gridColumn:"span 6"}}>PE hadice 16 mm</div><div style={{gridColumn:"span 3",textAlign:"right"}}>120</div><div style={{gridColumn:"span 2"}}>m</div><div style={{gridColumn:"span 1",textAlign:"right"}}>‚Äî</div></div>
                        </div>
                      </div>

                      <div className="card" style={{marginBottom:12}}>
                        <div className="card-h"><div>N√°≈ôad√≠</div><button>P≈ôidat polo≈æku</button></div>
                        <div className="card-c small">
                          <div className="row"><div style={{gridColumn:"span 9"}}>Vibraƒçn√≠ deska 100 kg</div><div style={{gridColumn:"span 3",textAlign:"right"}}>1 ks</div></div>
                          <div className="row"><div style={{gridColumn:"span 9"}}>Vrtac√≠ kladivo SDS‚ÄëMax</div><div style={{gridColumn:"span 3",textAlign:"right"}}>1 ks</div></div>
                        </div>
                      </div>

                      <div className="card">
                        <div className="card-h"><div>Fotodokumentace</div></div>
                        <div className="card-c">
                          <p className="small">Nahran√© fotky se automaticky zmen≈°√≠ na max. 1200 px (JPEG) pro rychl√© naƒç√≠t√°n√≠.</p>
                          <label><input id={"file-"+z.id} type="file" accept="image/*" onChange={(e)=>compress(e,1200,0.8,z.id)}/><button className="ghost">Nahr√°t fotku</button></label>
                          <div id={"preview-"+z.id} style={{marginTop:12}}></div>
                        </div>
                      </div>
                    </div>
                  )}
                  <div style={{marginTop:12, display:"flex", gap:8}}>
                    <button onClick={()=> setStage(s=>({...s,[z.id]: pipeline(s[z.id]||z.status)}))}>Posunout stav</button>
                    <button className="ghost" onClick={()=>exportSection(z.id)}>Export PDF n√°hledu</button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        );
      }

      function Employees(){
        const [q, setQ] = useState("");
        const [open, setOpen] = useState(null);
        const filtered = useMemo(()=> EMPLOYEES.filter(e=> (e.name.toLowerCase().includes(q.toLowerCase()))), [q]);
        const times = {
          e1:[{date:"2025-10-01",hours:8,job:"√ödr≈æba parku ‚Äì Kunice"},{date:"2025-10-02",hours:6,job:"Instalace z√°vlah ‚Äì Praha 6"}],
          e2:[{date:"2025-10-02",hours:9,job:"V√Ωsadba sadu ‚Äì Lipn√≠k"}],
          e3:[{date:"2025-10-03",hours:7.5,job:"Instalace z√°vlah ‚Äì Praha 6"}],
        };
        return (
          <div>
            <div className="search" style={{margin:"8px 0 12px"}}>
              <input value={q} onChange={e=> setQ(e.target.value)} placeholder="Hledat jm√©no‚Ä¶"/>
              <button className="ghost">Hledat</button>
            </div>
            <div className="grid" style={{gridTemplateColumns:"repeat(3,1fr)"}}>
              {filtered.map(e=> (
                <div className="card" key={e.id}>
                  <div className="card-h">
                    <div style={{fontWeight:600}}>{e.name}</div>
                    <span className="badge">{e.role}</span>
                  </div>
                  <div className="card-c">
                    <div className="small mono">ID: {e.id.toUpperCase()}</div>
                    <button className="ghost" style={{marginTop:8}} onClick={()=> setOpen(open===e.id? null : e.id)}>
                      {open===e.id? "Skr√Ωt v√Ωkazy" : "Zobrazit v√Ωkazy"}
                    </button>
                    {open===e.id && (
                      <div style={{marginTop:12}}>
                        <div className="row h"><div style={{gridColumn:"span 4"}}>Den</div><div style={{gridColumn:"span 2",textAlign:"right"}}>Hod</div><div style={{gridColumn:"span 6"}}>Zak√°zka</div></div>
                        {(times[e.id]||[]).map((r,i)=> (
                          <div className="row small" key={i}><div style={{gridColumn:"span 4"}}>{r.date}</div><div style={{gridColumn:"span 2",textAlign:"right"}}>{r.hours}</div><div style={{gridColumn:"span 6"}}>{r.job}</div></div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        );
      }

      function Warehouse(){
        const [site, setSite] = useState("lipnik");
        const [q, setQ] = useState("");
        const data = WAREHOUSE[site];
        const rows = [];
        Object.entries(data||{}).forEach(([cat,items])=>{
          (items||[]).forEach(it=> rows.push({...it, path:cat}));
        });
        const filtered = rows.filter(r=> r.name.toLowerCase().includes(q.toLowerCase()));
        return (
          <div>
            <div style={{display:"flex",gap:8,alignItems:"center",margin:"8px 0 12px"}}>
              <div className="tabs">
                <div className={"tab"+(site==="lipnik"?" active":"")} onClick={()=>setSite("lipnik")}>Lipn√≠k</div>
                <div className={"tab"+(site==="praha"?" active":"")} onClick={()=>setSite("praha")}>Praha</div>
              </div>
              <div className="search" style={{flex:1}}>
                <input value={q} onChange={e=> setQ(e.target.value)} placeholder="Hledat polo≈æku‚Ä¶"/>
                <button className="ghost">Hledat</button>
              </div>
              <button>Nov√° polo≈æka</button>
            </div>
            <div className="card">
              <div className="card-c">
                <div className="row h"><div style={{gridColumn:"span 4"}}>Kategorie</div><div style={{gridColumn:"span 5"}}>N√°zev</div><div style={{gridColumn:"span 2",textAlign:"right"}}>Mno≈æstv√≠</div><div style={{gridColumn:"span 1",textAlign:"right"}}>Jedn.</div></div>
                {filtered.length===0 && <div className="empty">Nic nenalezeno‚Ä¶</div>}
                {filtered.map(r=> (
                  <div className="row small" key={r.id}><div style={{gridColumn:"span 4"}}>{r.path}</div><div style={{gridColumn:"span 5"}}>{r.name}</div><div style={{gridColumn:"span 2",textAlign:"right"}}>{r.qty}</div><div style={{gridColumn:"span 1",textAlign:"right"}}>{r.unit}</div></div>
                ))}
              </div>
            </div>
          </div>
        );
      }

      function Settings(){
        return (
          <div className="card">
            <div className="card-c">
              <div className="row small"><div style={{gridColumn:"span 12"}}><b>Vzhled:</b> vysok√Ω kontrast, tmav√© pozad√≠, svƒõtl√© p√≠smo. ≈Ω√°dn√© zelen√© p√≠smo.</div></div>
              <div className="row small"><div style={{gridColumn:"span 12"}}><b>Export:</b> tlaƒç√≠tko ‚ÄûExport PDF n√°hledu‚Äú je demo (vytvo≈ô√≠ tiskov√Ω dialog pro konkr√©tn√≠ zak√°zku).</div></div>
            </div>
          </div>
        );
      }

      function App(){
        const [tab, setTab] = useState("jobs");
        return (
          <div>
            <Tabs value={tab} onChange={setTab}/>
            <div style={{height:12}}/>
            {tab==="jobs" && <Jobs/>}
            {tab==="employees" && <Employees/>}
            {tab==="warehouse" && <Warehouse/>}
            {tab==="settings" && <Settings/>}
          </div>
        );
      }

      // ---- Helpers ----
      function compress(e,maxSide=1200,quality=0.8, id){ // image compressor (canvas ‚Üí JPEG)
        const file = e.target.files?.[0]; if(!file) return;
        const img = new Image();
        const reader = new FileReader();
        reader.onload = () => { img.src = reader.result; };
        reader.readAsDataURL(file);
        img.onload = () => {
          const scale = (img.width>img.height) ? maxSide/img.width : maxSide/img.height;
          const w = Math.round(img.width*scale);
          const h = Math.round(img.height*scale);
          const c = document.createElement("canvas");
          c.width = w; c.height = h;
          const ctx = c.getContext("2d");
          ctx.drawImage(img,0,0,w,h);
          const url = c.toDataURL("image/jpeg", quality);
          const preview = document.getElementById("preview-"+id);
          preview.innerHTML = "";
          const im = document.createElement("img");
          im.src = url; im.className="img-preview";
          preview.appendChild(im);
        };
      }

      function exportSection(jobId){
        // jednoduch√Ω ‚Äûprint to PDF‚Äú export aktu√°ln√≠ str√°nky ‚Äì user si ulo≈æ√≠ jako PDF
        window.print();
      }

      ReactDOM.createRoot(document.getElementById("app")).render(<App/>);
      document.getElementById("year").textContent = new Date().getFullYear();
    </script>
  </body>
</html>
